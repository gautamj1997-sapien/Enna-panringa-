<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Get To Know Game</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    html,
    body {
      margin: 0;
      padding: 0;
      font-family: sans-serif;
      background: #fafafd;
    }
    .center {
      text-align: center;
    }
    .container {
      max-width: 400px;
      margin: 18px auto;
      padding: 10px;
    }
    .btn {
      padding: 8px 24px;
      margin: 6px 4px;
      background: #009ffd;
      color: #fff;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1rem;
      font-weight: bold;
      outline: none;
      transition: background 0.21s, box-shadow 0.21s;
    }
    .btn.secondary {
      background: #e52e71;
    }
    .btn:disabled {
      cursor: not-allowed;
      opacity: 0.6;
      box-shadow: none !important;
      background: #606c8d !important;
    }
    .btn:active,
    .btn.animated {
      box-shadow: 0 0 0 3px #e52e7133;
      background: #607be0 !important;
    }
    h1,
    h2,
    h3 {
      margin-bottom: 14px;
    }
    input,
    textarea {
      padding: 7px;
      font-size: 1rem;
      margin: 7px 0;
      border-radius: 7px;
      border: 1px solid #c8c5d0;
      width: 100%;
      box-sizing: border-box;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin: 24px 0;
    }
    .tile {
      width: 90px;
      height: 90px;
      background: #f6f6f8;
      border-radius: 18px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 1.28rem;
      box-shadow: 0 2px 14px #ccc;
      position: relative;
      transition: background 0.3s, box-shadow 0.3s;
    }
    .tile.flip {
      animation: flip 0.7s;
    }
    @keyframes flip {
      0% {
        transform: rotateY(0deg);
      }
      50% {
        transform: rotateY(90deg);
      }
      100% {
        transform: rotateY(0deg);
      }
    }
    .tile.x {
      background: #fbe5f8;
      border: 3px solid #e52e71;
    }
    .tile.o {
      background: #e6f8ff;
      border: 3px solid #009ffd;
    }
    .tile .mark {
      font-size: 2rem;
      font-weight: bold;
      letter-spacing: 2px;
    }
    .footer {
      margin-top: 14px;
      text-align: center;
    }
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(19, 15, 36, 0.22);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 100;
    }
    .modal-content {
      background: white;
      padding: 36px 16px;
      border-radius: 18px;
      min-width: 230px;
      max-width: 350px;
      box-shadow: 0 4px 38px rgba(0, 0, 0, 0.09);
    }
    .confetti {
      pointer-events: none;
      position: fixed;
      left: 0;
      top: 0;
      width: 100vw;
      height: 100vh;
      z-index: 300;
    }
    .header {
      margin-bottom: 17px;
    }
    .player {
      font-weight: bold;
    }
    .firework-bg {
      background: radial-gradient(
        circle at 70% 40%,
        #e52e71 1%,
        #6a63ff 67%,
        #fff 100%
      );
    }
    .pressed {
      animation: press 0.3s;
    }
    @keyframes press {
      0% {
        transform: scale(1);
      }
      65% {
        transform: scale(0.95);
      }
      100% {
        transform: scale(1);
      }
    }
    @media (max-width: 475px) {
      .container {
        max-width: 97vw;
      }
      .tile {
        width: 66px;
        height: 66px;
        font-size: 0.95rem;
      }
      .modal-content {
        max-width: 95vw;
      }
    }
  </style>
</head>
<body>
  <div id="main"></div>

  <script>
    /************ CONFIG & DATA ***************/
    const GAME_SIZE = 9;
    const HISTORY_KEY = "gtng_history";
    const QUESTIONS = [
      "Which Tamil comedy scene always makes you laugh? ü§£",
      "If you could only use three emojis for the rest of the week, what would they be? üòéü•≤ü§£",
      "Would you rather have unlimited popcorn üçø or unlimited ice cream üç¶ forever? Biryani irundirda atha sollirpinga, theriyum adaa options le vekaleü§£",
      "What's the silliest thing you're scared about?",
      "If you had a pet parrot ü¶ú, what‚Äôs the funniest thing you‚Äôd teach it to say?",
      "Ungaluku Kamal Hassan oda fav movie and dialoge ennaüòâ",
      "What‚Äôs the weirdest food combo you actually enjoy?",
      "What‚Äôs the funniest nickname you‚Äôve ever had?",
      "What song do you ALWAYS sing when no one‚Äôs listening?",
      "Would you rather pick midnight bike/car ride üö≤ or a beach walk üåä?",
      "If you could swap lives with a Tamil movie character for one day, who would it be and why?",
      "What‚Äôs the most random talent or trick you have?",
      "What‚Äôs the most adventurous thing you‚Äôve done?",
      "If you were in Bigg Boss house, how long would you survive?",
      "What‚Äôs one childhood memory that shaped who you are today?",
      "Neenga past ku poy oru naal marbdyu re-live panra vaypu kadacha, which day would it be?",
      "What instantly makes you feel calm and safe? üå∏",
      "What‚Äôs something small that gives you big happiness?",
      "Who in your life has inspired you the most, and why?",
      "If you could go back in time and meet your younger self, avangluku enna solla virbvinga?",
      "Do you prefer to express feelings through words üé§, actions ü§ù, or silence üåô?",
      "If your love story was a Tamil movie, what would the title be? üé¨üíï",
      "What‚Äôs the sweetest thing you think I've observed or told you that made you feel special, even a little bitü´£?",
      "If I was a character in your life‚Äôs movie, what role would I play? üòâ",
      "Enna nenakringa, do you think soulmates are destined, or do we create them?",
      "What‚Äôs one thing you dream of doing with someone special someday? üåå",
      "What kind of moment makes your heart race the most? üí£",
      "If the emotions you're feeling right now had a color, what color would yours be right now?"
    ];

    function getHistory() {
      try {
        return JSON.parse(localStorage.getItem(HISTORY_KEY)) || [];
      } catch {
        return [];
      }
    }
    function setHistory(arr) {
      localStorage.setItem(HISTORY_KEY, JSON.stringify(arr));
    }
    function clearHistoryStorage() {
      localStorage.removeItem(HISTORY_KEY);
    }
    /************ STATE MGMT ***************/
    let state = {
      step: "greeting", // greeting, names, toss, game, answer, firework, complete
      players: ["", ""],
      inputNames: ["", ""],
      activePlayer: 0,
      tossCaller: 0,
      tossCall: null,
      tossing: false,
      tossWinner: null,
      grid: Array(GAME_SIZE).fill(null), // {qIdx,pIdx,answer}
      questionIndexes: [],
      askedTiles: [],
      currentTile: null,
      answerText: "",
      showConfetti: false,
      showFireworks: false,
      gameDone: false,
      history: getHistory()
    };
    /************ RENDERING / UI ***********/
    function render() {
      main.innerHTML = "";
      switch (state.step) {
        case "greeting":
          main.innerHTML = `
      <div class="container center">
        <h1>Naa ready, neenga ready ah? üòé</h1>
        <button class="btn secondary" onclick="btnClick(setStep, 'names')">Let's go!</button>
      </div>`;
          break;
        case "names":
          main.innerHTML = `
      <div class="container center">
        <h2>Tell me your names üëÄ</h2>
        <input placeholder="Player 1" maxlength="20" autofocus value="${state.inputNames[0]}"
          oninput="nameChange(0,this.value)">
        <br>
        <input placeholder="Player 2" maxlength="20" value="${state.inputNames[1]}"
          oninput="nameChange(1,this.value)">
        <br>
        <button class="btn secondary" onclick="btnClick(submitNames)">Continue</button>
      </div>`;
          break;
        case "toss":
          main.innerHTML = `
      <div class="container center">
        <h2>${state.players[state.tossCaller]}, call Heads or Tails:</h2>
        ${state.tossing
          ? `<div style="margin:22px;font-size:1.55rem;">üîÑ Flipping...</div>`
          : state.tossWinner !== null
            ? `<h3>${state.players[state.tossWinner]} has won the toss and will begin the game!</h3>`
            : TOSS_OPTIONS.map((opt) => `<button class="btn" onclick="btnClick(flipToss, '${opt}')">${opt}</button>`).join("")
          }
      </div>`;
          break;
        case "game":
          main.innerHTML = `
      <div class="container">
        <div class="header">
          <span class="player" style="color:${state.activePlayer == 0 ? "#e52e71" : "#009ffd"}">
            ${state.players[state.activePlayer]} <span class="mark">${state.activePlayer == 0 ? "X" : "O"}</span>
          </span>'s turn
        </div>
        <div class="grid">
          ${state.grid
            .map(
              (cell, idx) => `
            <div class="tile${cell ? " flip" : ""}${cell ? (cell.pIdx == 0 ? " x" : " o") : ""}" onclick="tileClick(${idx})">
              ${
                cell
                  ? `<span class="mark">${cell.pIdx == 0 ? "X" : "O"}</span>
                 <div style="font-size:.82rem;margin-top:3px;color:#222">${cell.answer.length > 22
                    ? cell.answer.slice(0, 22) + "..."
                    : cell.answer}</div>`
                  : `<span style="font-size:1.09rem;color:#333">?</span>`
              }
            </div>`
            )
            .join("")}
        </div>
        ${state.showConfetti ? renderConfetti() : ""}
        <div class="footer">
          <button class="btn" onclick="btnClick(setStep, 'greeting')">Home</button>
          <button class="btn" onclick="btnClick(clearHistory)">Clear History</button>
        </div>
      </div>`;
          break;
        case "answer":
          main.innerHTML = `<div class="modal">
      <div class="modal-content center">
        <h3>${state.players[state.activePlayer]}, Answer:</h3>
        <div style="font-weight:bold;margin-bottom:8px;">
          ${QUESTIONS[state.questionIndexes[state.currentTile]]}
        </div>
        <textarea rows="2" maxlength="150" autofocus placeholder="Type your answer..." oninput="answerChange(this.value)">${state.answerText}</textarea>
        <br>
        <button id="submitBtn" class="btn secondary" onclick="btnClick(submitAnswer)"${!state.answerText ? " disabled" : ""}>Submit</button>
        <button id="cancelBtn" class="btn" onclick="btnClick(cancelAnswer)">Cancel</button>
      </div>
    </div>`;
          break;
        case "firework":
          main.innerHTML = `<div class="container center firework-bg" style="height:95vh;">
      <h1 style="color:#fff;">You are getting <span style="color:#e52e71;">dangerously closeüíñ</span></h1>
      <div style="margin-top:40px;">${renderFireworks()}</div>
    </div>`;
          setTimeout(() => {
            setStep("complete");
          }, 5000); // last 5s!
          break;
        case "complete":
          main.innerHTML = `<div class="container center">
      <h2>All questions answered!</h2>
      <button class="btn secondary" onclick="btnClick(setStep, 'game')">Play Again</button>
      <button class="btn" onclick="btnClick(clearHistory)">Clear History</button>
    </div>`;
          break;
      }
    }
    // Button animated feedback + disables submit/cancel buttons briefly
    window.btnClick = function (fn, arg) {
      event.target.classList.add("pressed");
      // Disable submit/cancel instantly when clicked
      const submitBtn = document.getElementById("submitBtn"),
        cancelBtn = document.getElementById("cancelBtn");
      if (submitBtn) submitBtn.disabled = true;
      if (cancelBtn) cancelBtn.disabled = true;
      // Remove disabled & pressed animation after 1300ms
      setTimeout(() => {
        if (submitBtn) submitBtn.disabled = false;
        if (cancelBtn) cancelBtn.disabled = false;
        event.target.classList.remove("pressed");
      }, 1300);
      setTimeout(() =>
        arg !== undefined ? fn(arg) : fn(), 90
      );
    };
    // Inputs
    window.nameChange = function (i, val) {
      state.inputNames[i] = val;
      render();
    };
    window.submitNames = function () {
      if (!state.inputNames[0] || !state.inputNames[1]) return;
      state.players = [...state.inputNames];
      state.tossCaller = Math.random() < 0.5 ? 0 : 1;
      setStep("toss");
    };
    window.tileClick = function (idx) {
      if (state.grid[idx]) return;
      state.currentTile = idx;
      state.step = "answer";
      render();
    };
    // Toss logic
    const TOSS_OPTIONS = ["Heads", "Tails"];
    window.flipToss = function (val) {
      state.tossCall = val;
      state.tossing = true;
      render();
      setTimeout(() => {
        let res = TOSS_OPTIONS[Math.floor(Math.random() * 2)];
        state.tossWinner = res == val ? state.tossCaller : 1 - state.tossCaller;
        state.activePlayer = state.tossWinner;
        state.tossing = false;
        render();
        setTimeout(() => setStep("game"), 1600);
      }, 1600);
    };
    window.answerChange = function (val) {
      state.answerText = val;
      render();
    };
    window.cancelAnswer = function () {
      state.step = "game";
      render();
    };
    window.submitAnswer = function () {
      let idx = state.currentTile,
        qIdx = state.questionIndexes[idx];
      state.grid[idx] = { qIdx: qIdx, pIdx: state.activePlayer, answer: state.answerText };
      state.askedTiles.push(idx);
      let hist = getHistory();
      hist.push(qIdx);
      setHistory([...new Set(hist)]);
      state.showConfetti = true;
      render();
      setTimeout(() => {
        if (state.askedTiles.length >= GAME_SIZE) {
          state.step = "firework";
          render();
        } else {
          state.activePlayer = 1 - state.activePlayer;
          state.step = "game";
          render();
        }
      }, 1300);
    };
    window.clearHistory = function () {
      clearHistoryStorage();
      state.history = [];
      setStep("greeting");
    };
    /************ UTILS ***************/
    function shuffle(arr) {
      for (let i = arr.length - 1; i > 0; i--) {
        let j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
    }
    function renderConfetti() {
      let d = document.createElement("div");
      d.className = "confetti";
      for (let i = 0; i < 60; i++) {
        let c = document.createElement("div");
        c.style = `position:absolute;
      left:${Math.random() * 99}vw;top:${Math.random() * 67}vh;
      width:14px;height:8px;background:${i % 2 == 0 ? "#e52e71" : "#009ffd"};
      border-radius:5px;opacity:.89;
      animation:down${i} 2s cubic-bezier(.22,.98,.35,.99) forwards;
      z-index:999;`;
        d.appendChild(c);
        let s = document.createElement("style");
        s.innerHTML = `@keyframes down${i}{ 0%{transform:translateY(0);} 90%{transform:translateY(${
          60 + Math.random() * 260
        }px);} 100%{opacity:0;}}`;
        d.appendChild(s);
      }
      setTimeout(() => {
        state.showConfetti = false;
        render();
      }, 2000);
      setTimeout(() => {
        d.remove();
      }, 2200);
      setTimeout(() => {
        document.body.appendChild(d);
      }, 90);
      return "";
    }
    function renderFireworks() {
      let stars = "";
      for (let i = 0; i < 90; i++)
        stars += `<span style="
    color:${Math.random() > 0.5 ? "#fff" : "#e52e71"};
    font-size:${7 + Math.random() * 39}px;
    left:${Math.random() * 99}vw;top:${12 + Math.random() * 75}vh;
    position:absolute;
    opacity:.7;
    ">‚òÖ</span>`;
      setTimeout(() => {
        state.showFireworks = false;
      }, 5000);
      return `<div style="position:relative;width:99vw;height:69vh;">${stars}</div>`;
    }
    /************ GAME LOGIC ***********/
    window.setStep = function (s) {
      Object.assign(state, {
        step: s,
        showConfetti: false,
        showFireworks: false,
        answerText: ""
      });
      if (s === "game") {
        state.gameDone = false;
        let pool = QUESTIONS.map((_, i) => i).filter((i) => getHistory().indexOf(i) === -1);
        if (pool.length < GAME_SIZE) {
          clearHistoryStorage();
          pool = QUESTIONS.map((_, i) => i);
          setHistory([]);
        }
        shuffle(pool);
        state.questionIndexes = pool.slice(0, GAME_SIZE);
        state.grid = Array(GAME_SIZE).fill(null);
        state.askedTiles = [];
        state.activePlayer = Math.random() < 0.5 ? 0 : 1;
        state.tossWinner = null;
        state.tossCaller = Math.random() < 0.5 ? 0 : 1;
      }
      render();
    };

    /************ INITIALIZE ***********/
    setStep(state.step);
  </script>
</body>
</html>
